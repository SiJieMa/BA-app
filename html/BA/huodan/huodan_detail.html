<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>货单详情</title>
		<link rel="stylesheet" type="text/css" href="../../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../../css/huodan/huodan_detial.css"/>
		<style>
			.goodmsg{ width: 100%; height: 45px; float: left; border-bottom: 1px solid #DDDDDD;}
			.goodmsg .kuai{ width: 5px; margin-right: 10px; height: 15px; margin-top: 15px; float: left; background-color: #FF0000; margin-left: 10px;}
			.goodmsg{ line-height: 45px; font-size: 14px;}
			.goodmsg .kuai1{ background-color: #71C4E4;}
			.goodmsg .jiahao666{ width: 20px; padding: 10px; height: 20px; float: right; margin-right: 10px;}
			.info{ width: 100%; height: auto; float: left;}
			.info ul{ width: 100%; height: auto; float: left;}
			.info ul li{ width: 90%; margin-left: 5%; margin-right: 5%; height: auto; float: left; border-bottom: 1px solid #f5f5f5;}
			.info ul li .leftitem{ width: 80px; height: auto; line-height: 40px; float: left; text-align: center;}
			.info ul li .rightitem{ width: auto; line-height: 20px; float: left; margin-top: 10px; margin-left: 5px;}

			.goodinfo{ width: 100%; height: auto; float: left; margin-bottom: 50px;}
			.goodinfo ul{ width: 100%; height: auto; float: left;}
			.goodinfo ul li{ padding: 5px 0; margin-top: 5px; border-radius: 5px; width: 94%; margin-left: 3%; margin-right: 3%; height: auto; float: left; background-color: #f5f5f5;}
			.goodinfo ul li .name{ width: 90%; height: auto; float: left; margin-left: 5%; margin-right: 5%;}
			.goodinfo ul li .name .left{ font-size: 14px; width: 80px; height: 25px; line-height: 25px; float: left; font-style: normal;}
			.goodinfo ul li .name .right{ color: #666; width: auto; height: auto; line-height: 25px; float: left; font-style: normal;}
			.goodinfo ul li .imglist{ width: 90%; height: auto; float: left; margin-left: 5%; margin-right: 5%;}
			.goodinfo ul li .imglist img{ width: 50px; height: 50px; float: left; margin: 5px 4px 5px 0;}
			.goodinfo ul li .inputnum{ width: 90%; margin-left: 5%; margin-right: 5%; float: left;}
			.goodinfo ul li .inputnum .editname{ width: 150px; line-height: 25px; height: 25px; float: left; font-size: 14px;}
			.goodinfo ul li .inputnum .editnum{ margin-bottom: 5px; width: 100px; height: 25px; float: left; background-color: #FFFFFF;}
			.goodinfo ul li .inputnum .editnum input{ width: 90px; margin-left: 5px; margin-right: 5px; float: left; outline: none; height: 20px; line-height: 20px; margin-top: 2.5px; text-align: center; }

			.bottom{ width: 100%; height: 50px; bottom: 0; left: 0; position: fixed; background-color: #f5f5f5; border-top: 1px solid #CCCCCC;}
			.bottom .one{ width: 35%; height: 35px; border-radius: 17.5px; line-height: 35px; font-size: 14px; margin-top: 7.5px; margin-left: 7.5%; margin-right: 7.5%; float: left; text-align: center; background-color: #FF5C01; color: #FFFFFF;}
			.bottom .two{ width: 35%; height: 35px; border-radius: 17.5px; line-height: 35px; font-size: 14px; margin-top: 7.5px; margin-left: 7.5%; margin-right: 7.5%; float: left; text-align: center; background-color: #71C4E4; color: #FFFFFF;}

			.GetListPic{ margin-top: 5px; margin-bottom: 5px; width: 94%; margin-left: 2.5%; height: auto; float: left; margin-bottom: 5px; background-color: #f5f5f5; border: 2px solid #f5f5f5;}
			.GetListPic .title{ width: 94%; height: 40px; line-height: 40px; float: left; padding: 0 3%; font-size: 14px;}
			.GetListPic .piclist{ width: 94%; height: auto; float: left;  padding: 5px 3%; background-color: #ffffff;}
			.GetListPic .piclist img{ width: 50px; height: 50px; float: left; margin-right: 5px;}

		</style>
	</head>
	<body>

		<!--<div class="timelineleft">
			<ul>
				<li>
					<i></i>
				</li>
				<li>
					<i></i>
				</li>
				<li>
					<i></i>
				</li>
			</ul>
		</div>-->

		<!--<div class="timeline">
			<ul id="list">
				<li>
					<div class="info">
						<span class="time">2018-02-02</span>
						<span class="name">某某某审核中</span>
					</div>
				</li>
				<li>
					<div class="info">
						<span class="time">2018-02-02</span>
						<span class="name">某某某审核中</span>
					</div>
				</li>
				<li>
					<div class="info">
						<span class="time">2018-02-02</span>
						<span class="name">某某某审核中</span>
					</div>
				</li>
			</ul>
		</div>-->
		<!--<span class="goodtitle">商品列表</span>-->

		<div class="goodmsg"><i class="kuai"></i>订单信息</div>
		<div class="info">
			<ul id="goodinfo">
				<!--<li>
					<span class="leftitem">左边文字</span>
					<span class="rightitem">右边文字</span>
				</li>-->
			</ul>
		</div>

		<div class="GetListPic">
			<span class="title">拍照留底:</span>
			<div id="piclistTUI" class="piclist">
			</div>
		</div>

		<div class="goodmsg"><i class="kuai kuai1"></i>商品信息
			<!--<img class="jiahao666" src="../../../../image/jiahao666.png" />-->
		</div>
		<div class="goodinfo">
			<ul id="shangpinlist">
				<!--<li>
					<span class="name"><i class="left">商品名称:</i><i class="right">商品名称商品名称商品名称商品名称</i></span>
					<div class="inputnum">
						<span class="editname">商品数量:</span>
						<div class="editnum">
							<input />
						</div>
					</div>
					<div class="inputnum">
						<span class="editname">商品单价:</span>
						<div class="editnum">
							<input />
						</div>
					</div>
				</li>-->
			</ul>
		</div>
	</body>
	<script type="text/javascript" src="../../../script/api.js"></script>
	<script type="text/javascript" src="../../../script/apiclear.js"></script>
	<script type="text/javascript" src="../../../script/log.js"></script>
	<script type="text/javascript" src="../../../script/kunchiba.js"></script>
	<script type="text/javascript" src="../../../script/kunchisale.js"></script>
	<script type="text/javascript">
	//*时间轴的最后一个li动态的设置为底边距为0
		apiready = function() {

			var detaillist = api.pageParam.page.detail;

			var goodinfo = document.getElementById("goodinfo");
			var html = '<li><span class="leftitem">订单号:</span><span class="rightitem">'+detaillist.cOrderCode+'</span></li>';
			$api.append(goodinfo, html);
			var html = '<li><span class="leftitem">门店名称:</span><span class="rightitem">'+detaillist.cStoreFullName+'</span></li>';
			$api.append(goodinfo, html);
			var html = '<li><span class="leftitem">订单时间:</span><span class="rightitem">'+detaillist.dtPrepTime.split("T")[0]+'  '+detaillist.dtPrepTime.split("T")[1]+'</span></li>';
			$api.append(goodinfo, html);

			if(detaillist.iOrderType == $api.getStorage("mendiandiaobodan")){
				var html = '<li><span class="leftitem">快递单号:</span><span class="rightitem">'+detaillist.cLogisticsNo+'</span></li>';
				$api.append(goodinfo, html);
			}
			
			var danjiaorzongjia = '商品单价';
			if(detaillist.iOrderType == $api.getStorage("xiaoshoudan")){
				danjiaorzongjia = '商品总价';
			}

			var el = document.getElementById("shangpinlist");
			for(var a = 0; a < detaillist.T_OrderDetail.length; a++){

				var xiugaishuliang = detaillist.T_OrderDetail[a].iModifyCount;
				var xiugaiDIV = '';
				if(!isempty(xiugaishuliang)){
					if(xiugaishuliang != detaillist.T_OrderDetail[a].iCount){
						xiugaiDIV = '<div class="inputnum">'
							+			'<span class="editname">审核修改后数量:</span>'
							+			'<div class="editnum">'
							+				'<input readonly="readonly" value="'+xiugaishuliang+'" />'
							+			'</div>'
							+		'</div>';
					}
				}

				var li = '<li>'
					+		'<span class="name"><i class="left">商品名称:</i><i class="right">'+detaillist.T_OrderDetail[a].cProductFullName+'</i></span>'
					+		'<div class="inputnum">'
					+			'<span class="editname">商品数量:</span>'
					+			'<div class="editnum">'
					+				'<input readonly="readonly" value="'+detaillist.T_OrderDetail[a].iCount+'" />'
					+			'</div>'
					+		'</div>'
					+		xiugaiDIV
					+		'<div class="inputnum">'
					+			'<span class="editname">'+danjiaorzongjia+':</span>'
					+			'<div class="editnum">'
					+				'<input readonly="readonly" value="'+detaillist.T_OrderDetail[a].iPrice+'" />'
					+			'</div>'
					+		'</div>'
					+	'</li>';

				$api.append(el, li);
			}

			var piclist = detaillist.T_Pics;
			if(piclist.length > 0){
				if(isempty(piclist)){
					return;
				}

				var piclistTUI = document.getElementById("piclistTUI");
				var db = api.require('db');
				for(var a = 0; a < piclist.length; a++){
					var ret = db.selectSqlSync({
					    name: 'kunchidb',
					    sql: 'SELECT * FROM piclist where picname = "'+piclist[a].cPicPath.split("/")[1]+'";'
					});
					var myDate = new Date();
					var imgid = myDate.getTime();
					var imgxml = '<img id="'+imgid+'" />';
					$api.append(piclistTUI, imgxml);
					if(ret.status){
						if(ret.data.length == 0){
							var srcurl = $api.posturllujie+'Content/UploadFiles/mobile/'+piclist[a].cPicPath;
							$kunchi.ImageHuanCun(srcurl, function(huancunurl){
								document.getElementById(imgid).src = huancunurl;
							});
						}else{
							var srcurl = 'data:image/jpg;base64,'+ret.data[0].picurl
							document.getElementById(imgid).src = srcurl;
						}
					}else{
						//还没有创建表
						var srcurl = $api.posturllujie+'Content/UploadFiles/mobile/'+piclist[a].cPicPath;
						$kunchi.ImageHuanCun(srcurl, function(huancunurl){
							document.getElementById(imgid).src = huancunurl;
						});
					}
				}
			}


		};
	</script>
</html>
