<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>待签收详情</title>
		<link rel="stylesheet" type="text/css" href="../../../css/api.css"/>
		<style>
			body, html{ background-color: #f5f5f5;}
			.start{ width: 100%; height: auto; float: left; margin-top: 5px; margin-bottom: 103px;}
			.start ul{ width: 100%; height: auto; float: left; margin-bottom: 10px; overflow: auto;}
			.start ul li{ width: 100%; height: auto; float: left; border-bottom: 1px solid #f5f5f5;}
			.start ul li .name{ width: 58%; min-height: 40px; padding-top: 10px; text-align: center; line-height: 20px; margin-left: 2%; float: left;}
			.start ul li .num{ width: 20%; height: 40px; line-height: 40px; text-align: center; float: left;}
			.start ul li .qiannum{ width: 20%; height: 40px; line-height: 40px; text-align: center; float: left;}
			.start ul li input{ background-color: #EEEEEE; outline: none; width: 19.5%; height: 30px; line-height: 30px; margin-top: 5px; text-align: center; float: left;}
			.queren{  float: left; width: 40%; margin-left: 10%; margin-bottom: 5px; height: 40px; border-radius: 3px; line-height: 40px; text-align: center; font-size: 15px; background-color: #71C4E4; color: #FFFFFF;}
			.jushou{  float: left; width: 40%; margin-left: 5%; margin-bottom: 5px; height: 40px; border-radius: 3px; line-height: 40px; text-align: center; font-size: 15px; background-color: #ff0000; color: #FFFFFF;}



			.start .dingdanhao{display: none; border-bottom: 1px solid #f5f5f5; width: 100%; height: auto; float: left;}
			.start .dingdanhao .danhao{ width: 30%; height: 40px; float: left; line-height: 40px; text-align: center;}
			.start .dingdanhao .inputdanhao{ width: 50%; height: 30px; line-height: 30px; margin-top: 5px; float: left; outline: none; font-size: 15px;}
			.start .dingdanhao .saodanhao{ width: 25px; height: 25px; float: right; padding: 7.5px;}

			.GetListPic{ width: 94%; margin-left: 3%; height: auto; float: left; margin-bottom: 5px; background-color: #f5f5f5; border: 1px solid #f5f5f5;}
			.GetListPic .title{ width: 94%; height: 40px; line-height: 40px; float: left; padding: 0 3%; font-size: 14px;}
			.GetListPic .piclist{ width: 94%; height: auto; float: left;  padding: 5px 3%; background-color: #FFFFFF;}
			.GetListPic .piclist img{ width: 50px; height: 50px; float: left; margin-right: 5px;}


			.goodlist{ width: 100%; height: auto; float: left; background-color: #71C4E4; margin-top: 10px;}
			.goodlist .title{ width: auto; margin-left: 10px; height: 45px; line-height: 45px; float: left; color: #FFFFFF; font-size: 16px;}
			.goodlist .addgood{ width: 20px; height: 20px; padding: 12.5px 10px; float: right;}
			.gooddetail{ width: 100%; height: auto; float: left; margin-bottom: 10px; overflow: scroll;}
			.gooddetail ul{ width: 100%; height: 100%; float: left;}
			.gooddetail ul li{ position: relative; padding-top: 5px; padding-bottom: 5px; border-radius: 5px; background-color: #FFFFFF; width: 96%; margin-left: 2%; margin-right: 2%; height: auto; float: left; margin-top: 5px;}
			.gooddetail ul li .downimg{ margin-right: 5px; margin-top: 5px; width: 30px; height: 30px; position: absolute; top: 0; right: 0;}
			.gooddetail ul li .item1{ width: 90%; font-size: 14px; margin-left: 5%; margin-right: 5%; height: auto; float: left; line-height: 25px; }
			.gooddetail ul li .item1 i{ font-style: normal; float: left;}
			.gooddetail ul li .item1 .num16{ font-size: 18px;}
			.gooddetail ul li .item1 .width80{ width: 80px;}
			.gooddetail ul li .item2{ width: 90%; height: auto; float: left; margin-left: 5%; margin-right: 5%;}
			.gooddetail ul li .item2 .leftitem{ width: 80px; height: 25px; float: left; line-height: 25px;}
			.gooddetail ul li .item2 .numinput{ width: 100px; height: 25px; float: left; border-bottom: 1px solid #CCCCCC;}
			.gooddetail ul li .item2 .numinput input{ width: 100px; height: 20px; line-height: 20px; float: left; margin-top: 2.5px; outline: none; text-align: center;}
			.gooddetail ul li .imagelist{ margin-top: 5px; width: 100%; height: auto; float: left;}
			.gooddetail ul li .imagelist .titlepic{ background-color: #f2f2f2; color: #71C4E4; width: 90%; padding-left: 5%; padding-right: 5%; height: 40px; float: left; line-height: 40px;}
			.gooddetail ul li .imagelist img{ width: 50px; height: 50px; float: left; margin: 5px;}

			.liyou{ display: none; width: 100%; height: 100%; position: fixed; top: 0; left: 0; z-index: 999; background-color: rgba(0,0,0,0.5);}
			.liyou .liyouson{ width: 90%; height: auto; float: left; background-color: #FFFFFF; margin-left: 5%;}
			.liyou .liyouson .liyoutitle{ width: 98%; height: 50px; line-height: 50px; float: left; padding-left: 2%; font-size: 16px; background-color: #f5f5f5;}
			.liyou .liyouson .liyouwenzi{ font-size: 16px; width: 96%; padding-left: 2%; padding-right: 2%; padding-top: 5px; padding-bottom: 5px; float: left; outline: none; height: 150px;}
			.liyou .liyouson .caozuo{ width: 100%; height: 50px; float: left;}
			.liyou .liyouson .caozuo span{ width: 50%; height: 50px; line-height: 50px; float: left; text-align: center; color: #FFFFFF;}
			.liyou .liyouson .caozuo .one{ background-color: #71C4E4;}
			.liyou .liyouson .caozuo .two{ background-color: #FF5C01;}
		</style>
	</head>
	<body id="body">

		<div id="liyou" class="liyou">
			<div id="liyoushuruinput" class="liyouson" style="margin-top: 100px;">
				<span class="liyoutitle">请填写签收备注:</span>
				<textarea id="tuiguoseason" class="liyouwenzi" placeholder="所需要备注的文字..."></textarea>
				<div class="caozuo">
					<span onclick="closeremark()" class="one">取消</span>
					<span onclick="jujueshenqing()" class="two">确定</span>
				</div>
			</div>
		</div>

		<div id="gooddetail" class="gooddetail">
			<ul id="goodlist">
				<!--<li>
					<span class="item1"><i class="width80">商品名称: </i><i>机房里的撒酒疯离开大树</i></span>
					<span class="item1"><i class="width80">商品编码: </i><i>商品编辑啊房间打扫垃圾分类</i></span>
					<span class="item1"><i class="width80">发货数量: </i><i class="num16">88</i></span>
					<div class="item2">
						<span class="leftitem">签收数量:</span>
						<div class="numinput">
							<input />
						</div>
					</div>
				</li>-->
			</ul>
		</div>

		<div id="GetListPic" class="GetListPic">
			<span class="title">签收拍照留底，最多可拍摄五张:</span>
			<div class="piclist" id="piclistTUI" value="0">
				<img id="selectPicAdd" onclick="openCarmerPai()" src="../../../image/addlan.png" />
			</div>
		</div>

		<span onclick="jushou()" class="jushou">拒收</span>
		<span onclick="qianshou()" class="queren">确认收货</span>
	</body>
	<script type="text/javascript" src="../../../script/api.js"></script>
	<script type="text/javascript" src="../../../script/apiclear.js"></script>
	<script type="text/javascript" src="../../../script/base64Update.js"></script>
	<script type="text/javascript" src="../../../script/synthesis.js"></script>
	<script type="text/javascript" src="../../../script/db.js"></script>
	<script type="text/javascript" src="../../../script/kunchiba.js"></script>
	<script type="text/javascript" src="../../../script/log.js"></script>
	<script type="text/javascript" src="../../../script/kunchisale.js"></script>
	<script type="text/javascript">

		var detail_ret;

		var datalistitem;

		//签收的时候的图片类型 也就是单据类型
		var PICdataTypeName = '签收图片';

		apiready = function() {

			var goodList = document.getElementById("goodlist");
			var winheight = api.winHeight;
			$api.css(goodList,'height: '+(winheight - 105)+'px;');
			initpic();
			datalistitem = api.pageParam.page.datalistitem;
			PICdataTypeName = api.pageParam.page.datetypename;
			//console.log(JSON.stringify(datalistitem));
			initlistheight();
			getorderdetail();
		};

		function closeremark(){
			var elliyou = document.getElementById("liyou");
			$api.css(elliyou,'display: none;');
		}

		function openremark(){
			var elliyou = document.getElementById("liyou");
			$api.css(elliyou,'display: block;');
		}


		function initlistheight(){
			var GetListPicel = document.getElementById("GetListPic");
			var gooddetailel = document.getElementById("gooddetail");
			var GetListPicheight = $api.cssVal(GetListPicel,'height');
			GetListPicheight = GetListPicheight.replace(/px/g, '');
			var marginbottom = parseInt(GetListPicheight) + 55 + 10;
			var winheight = api.frameHeight;
			$api.css(gooddetailel,'height: '+(winheight - marginbottom)+'px;');
		}

		function getorderdetail(){
			jiazai();
			var body = new Object();
			body.orderid = api.pageParam.page.orderid;
			$kunchi.kunchipost("ActionApi/T_Orders/GetSingeT_OrderDetailList", body, function(ret,err){
				//console.log(JSON.stringify(ret) + "---" + JSON.stringify(err));
				tingzhi();
				if(ret){
					detail_ret = ret;
					dealxml(ret);
				}else{
					api.confirm({
					    title: '提示',
					    msg: '当前网络错误,您可以重新尝试或者等网络通常后再试.',
					    buttons: ['重试', '稍后再说']
					}, function(ret, err) {
					    var index = ret.buttonIndex;
					    if(index == 1){
					    	getorderdetail();
					    }else if(index == 2){
					    	api.closeWin({
                            });
					    }
					});
				}
			});
		}

		function dealxml(ret){
			var el = document.getElementById("goodlist");
			for(var a = 0; a < ret.length; a++){
				var html = '<li id="'+ret[a].id+'">'
						+		'<span class="item1"><i class="width80">商品名称: </i><i>'+ret[a].cProductFullName+'</i></span>'
						+		'<span class="item1"><i class="width80">商品编码: </i><i>'+ret[a].cProductProductCode+'</i></span>'
						+		'<span class="item1"><i class="width80">发货数量: </i><i class="num16">'+ret[a].iSendCount+'</i></span>'
						+		'<div class="item2">'
						+			'<span class="leftitem">签收数量:</span>'
						+			'<div class="numinput">'
						+				'<input type="tel" id="input'+ret[a].id+'" iSendCount="'+ret[a].iSendCount+'"/>'
						+			'</div>'
						+		'</div>'
						+	'</li>';

				$api.append(el, html);
			}
		}

		function qianshou(){
			var monthid = "goodlist";
			var elmothli = document.getElementById(monthid);
			var inputlist = $api.domAll(elmothli, 'input');
			var isok = false;
			var sigetall = 0;
			for(var a = 0; a < inputlist.length; a++){
				var inputtxt = $api.val(inputlist[a]);
				var salenum = $api.attr(inputlist[a], 'iSendCount');
				if(inputtxt != ""){
					isok = true;
				}
				if(parseInt(inputtxt) != parseInt(salenum)){
					sigetall = 1;
				}
			}

			if(!isok){
				alert('请填写签收数量后再进行签收.');
				return;
			}
			if(sigetall == 1){
				mustBePhoto = 1;
				openremark();
			}else {
				qianshou_post();
			}
		}

		function jujueshenqing(){
			closeremark();
			qianshou_post();
		}

		var mustBePhoto = 0;
		function qianshou_post(){
			var postjson = new Object();
			/**
			 *是否允许签收
			 */
			var isqianshou = false;
			/**
			 *判断是否有比应接收数高德地方
			 */
			var istall = false;
			/**
			 * 是否有签收数量不一样的
			 */
			var isdef = false;

			var detaillist = new Array();


			var iStoreIdjson, cSideId;
			iStoreIdjson = datalistitem.iStoreId;
			cSideId = datalistitem.cSideId;

			postjson.id = datalistitem.id;
			postjson.cOrderCode = datalistitem.cOrderCode;
			postjson.iOrderType = datalistitem.iOrderType;
			postjson.iPreparedId = datalistitem.iPreparedId;
			postjson.dtPrepTime = datalistitem.dtPrepTime;
			postjson.iAuthorizeId = datalistitem.iAuthorizeId;
			postjson.dtAuthorizeTime = datalistitem.dtAuthorizeTime;
			postjson.iSignId = $api.getStorage("id");
			postjson.dtSignTime = datalistitem.dtSignTime;
			postjson.iOrderState = $api.getStorage('baiOrderStateyi');
			postjson.iAuthoState = datalistitem.iAuthoState;
			postjson.iStoreHouseId = datalistitem.iStoreHouseId;
			postjson.iStoreId = iStoreIdjson;
			postjson.cSideId = cSideId;
			postjson.cSidePic = "";
			postjson.cSideType = datalistitem.cSideType;
			//添加扫描单号的功能
			postjson.cLogisticsNo = datalistitem.cLogisticsNo;
			postjson.iSourceId = datalistitem.iSourceId;

			postjson.tTimeStamp = datalistitem.tTimeStamp;
			postjson.iDirectorId = datalistitem.iDirectorId;
			postjson.dtUpdate = datalistitem.dtUpdate;
			postjson.cOrderCode = datalistitem.cOrderCode;
			postjson.cSignName = datalistitem.cSignName;
			postjson.cSignTele = datalistitem.cSignTele;
			postjson.cSignAddress = datalistitem.cSignAddress;

			//判断是否存在签收数量为0的
			var isyouzero = 0;
			for(var b = 0; b < detail_ret.length; b++){
				var jsonsondetail = new Object();
				jsonsondetail.id = detail_ret[b].id;
				var elinput = document.getElementById('input'+detail_ret[b].id);
				var iSignCount = $api.val(elinput);
				if(isempty(iSignCount)){
					iSignCount = 0;
				}
				if(iSignCount >= 0){
					isqianshou = true;
				}

				if(iSignCount > detail_ret[b].iSendCount){
					istall = true;
				}
				
				if(iSignCount != detail_ret[b].iSendCount){
					isdef = true;
				}

				iSignCount = parseInt(iSignCount);

				if(iSignCount == 0){
					isyouzero = 1;
				}

				jsonsondetail.iOrderId = detail_ret[b].iOrderId;
				jsonsondetail.iCount = detail_ret[b].iCount;
				jsonsondetail.iInventtoryId = detail_ret[b].iInventtoryId;
				jsonsondetail.iMoney = detail_ret[b].iMoney;
				jsonsondetail.iPrice = detail_ret[b].iPrice;
				jsonsondetail.iProId = detail_ret[b].iProId;
				jsonsondetail.iStoreHouseId = detail_ret[b].iStoreHouseId;

				jsonsondetail.iSendCount = detail_ret[b].iSendCount;
				jsonsondetail.iSignCount = iSignCount;
				jsonsondetail.tTimeStamp = detail_ret[b].tTimeStamp;
				//jsonsondetail.cProductFullName = daishoulist[a].T_OrderDetail[b].cProductFullName;
				detaillist.push(jsonsondetail);
			}


			postjson.T_OrderDetail = detaillist;

			/**
			 *将退货的图片列表加进去
			 */
			var TJjson = new Object();
			TJjson._Order = postjson;
			var selectPicListID_EL = document.getElementById("piclistTUI");
			var picNumber = $api.attr(selectPicListID_EL, 'value');

			var TJpiclist = new Array();
			if(picNumber > 0){
				for(var pa = 0; pa < picNumber; pa++){
					var TJpicDOM = $api.domAll(selectPicListID_EL, 'img');
					var TJpicObj = new Object();
					TJpicObj.cPicClass = '签收拍照'+PICdataTypeName;
					TJpicObj.cPicPath = $kunchi.gettodaydate() + '/' + $api.attr(TJpicDOM[pa], 'name');
					TJpicObj.cPicType = "PhotoType";
					TJpicObj.cRoleName = $api.getStorage("roleName");
					TJpicObj.cUserName = $api.getStorage("realName");
					TJpicObj.iStoreId = api.pageParam.page.istoreid;
					TJpicObj.iSize = 0;
					TJpicObj.iUserId = $api.getStorage("id");
					TJpicObj.dtUploadTime = $kunchi.todaytime();
					TJpiclist.push(TJpicObj);
				}
			}
			TJjson._Pic = TJpiclist;

			if((mustBePhoto == 1)&&(picNumber == 0)){
				tingzhi();
				alert('请至少拍摄一张照片再进行签收.');
				return;
			}

			var tuiguoseason = document.getElementById("tuiguoseason").value;

			if((isyouzero == 1)&&(tuiguoseason.trim().length == 0)){
				alert('请认真填写签收理由');
				return;
			}
			
			if(isdef){
				alert('您有签收数量与发货数量不对应的商品,请认真填写签收理由');
				return;
			}

			postjson.cRemark = tuiguoseason;

			if(!isqianshou){
				tingzhi();
				alert('请右上角向下箭头并填写收到的货物数量.');
				return;
			}

			if(istall){
				tingzhi();
				alert('签收数量不可以大于订单发货数量.');
				return;
			}

			/**
			 * 上传报告的时候 要停止后台上传图片否则无法离店
			 */
			$api.setStorage("iscloseupload","1");
			api.cancelAjax({
			    tag: 'uploadpic'
			});
			jiazai();
			//console.log(JSON.stringify(postjson));
			$kunchi.kunchipost("ActionApi/T_Orders/SingeT_Orders", TJjson, function(ret,err){
				tingzhi();
				$api.setStorage("iscloseupload","0");
				api.sendEvent({
			        name:'upload_databasepic'
		        });
		        //console.log(JSON.stringify(ret) + "---" + JSON.stringify(err));
				if(ret){
					api.alert({
					    title: '提示',
					    msg: '签收成功',
					}, function(ret, err) {
						api.sendEvent({
						    name: 'qianshouwancheng',
						    extra: {
						        key1: api.pageParam.page.orderid
						    }
						});
					});
				}else{
					api.alert({
					    title: '提示',
					    msg: '签收失败',
					}, function(ccc, aaa) {
						//post_other_errorinfo(JSON.stringify(postjson), $api.getStorage("id"), "ActionApi/T_Orders/SingeT_Orders", JSON.stringify(err));
					});
				}
//				console.log(JSON.stringify(ret) + "----" + JSON.stringify(err));
			});
		}



		function jushou(){

			api.confirm({
			    title: '提示',
			    msg: '您是要拒绝签收这个订单吗?',
			    buttons: ['确定', '取消']
			}, function(abcd, efgh) {
			    var indexabcd = abcd.buttonIndex;
			    if(indexabcd == 1){

					var postjson = new Object();
					/**
					 *是否允许签收
					 */
					var isqianshou = false;
					/**
					 *判断是否有比应接收数高德地方
					 */
					var istall = false;

					var detaillist = new Array();


					var iStoreIdjson, cSideId;
					iStoreIdjson = datalistitem.iStoreId;
					cSideId = datalistitem.cSideId;

					postjson.id = datalistitem.id;
					postjson.cOrderCode = datalistitem.cOrderCode;
					postjson.iOrderType = datalistitem.iOrderType;
					postjson.iPreparedId = datalistitem.iPreparedId;
					postjson.dtPrepTime = datalistitem.dtPrepTime;
					postjson.iAuthorizeId = datalistitem.iAuthorizeId;
					postjson.dtAuthorizeTime = datalistitem.dtAuthorizeTime;
					postjson.iSignId = $api.getStorage("id");
					postjson.dtSignTime = datalistitem.dtSignTime;
					postjson.iOrderState = $api.getStorage('baiOrderStatejushou');
					postjson.iAuthoState = datalistitem.iAuthoState;
					postjson.iStoreHouseId = datalistitem.iStoreHouseId;
					postjson.iStoreId = iStoreIdjson;
					postjson.cSideId = cSideId;
					postjson.cSidePic = "";
					postjson.cSideType = datalistitem.cSideType;
					//添加扫描单号的功能
					postjson.cLogisticsNo = datalistitem.cLogisticsNo;
					postjson.iSourceId = datalistitem.iSourceId;
					postjson.cRemark = datalistitem.cRemark;
					postjson.tTimeStamp = datalistitem.tTimeStamp;
					postjson.iDirectorId = datalistitem.iDirectorId;
					postjson.dtUpdate = datalistitem.dtUpdate;
					postjson.cOrderCode = datalistitem.cOrderCode;
					postjson.cSignName = datalistitem.cSignName;
					postjson.cSignTele = datalistitem.cSignTele;
					postjson.cSignAddress = datalistitem.cSignAddress;
					for(var b = 0; b < detail_ret.length; b++){
						var jsonsondetail = new Object();
						jsonsondetail.id = detail_ret[b].id;

						iSignCount = 0;

						jsonsondetail.iOrderId = detail_ret[b].iOrderId;
						jsonsondetail.iCount = detail_ret[b].iCount;
						jsonsondetail.iInventtoryId = detail_ret[b].iInventtoryId;
						jsonsondetail.iMoney = detail_ret[b].iMoney;
						jsonsondetail.iPrice = detail_ret[b].iPrice;
						jsonsondetail.iProId = detail_ret[b].iProId;
						jsonsondetail.iStoreHouseId = detail_ret[b].iStoreHouseId;

						jsonsondetail.iSendCount = detail_ret[b].iSendCount;
						jsonsondetail.iSignCount = iSignCount;
						jsonsondetail.tTimeStamp = detail_ret[b].tTimeStamp;
						//jsonsondetail.cProductFullName = daishoulist[a].T_OrderDetail[b].cProductFullName;
						detaillist.push(jsonsondetail);
					}

					postjson.T_OrderDetail = detaillist;

					/**
					 *将退货的图片列表加进去
					 */
					var TJjson = new Object();
					TJjson._Order = postjson;
					//console.log(JSON.stringify(TJjson));
					//return;

					/**
					 * 上传报告的时候 要停止后台上传图片否则无法离店
					 */
					$api.setStorage("iscloseupload","1");
					api.cancelAjax({
					    tag: 'uploadpic'
					});
					//console.log(JSON.stringify(postjson));
					//return;
					jiazai();
					$kunchi.kunchipost("ActionApi/T_Orders/ReturnT_Orders", TJjson, function(ret,err){
						tingzhi();
						$api.setStorage("iscloseupload","0");
						api.sendEvent({
					        name:'upload_databasepic'
				        });
				        //console.log(JSON.stringify(ret) + "---" + JSON.stringify(err));
						if(ret){
							api.alert({
							    title: '提示',
							    msg: '已拒收',
							}, function(ret, err) {
								api.sendEvent({
								    name: 'qianshouwancheng',
								    extra: {
								        key1: api.pageParam.page.orderid
								    }
								});
							});
						}else{
							api.alert({
							    title: '提示',
							    msg: '拒收失败',
							}, function(ccc, aaa) {
								//post_other_errorinfo(JSON.stringify(postjson), $api.getStorage("id"), "ActionApi/T_Orders/SingeT_Orders", JSON.stringify(err));
							});
						}
		//				console.log(JSON.stringify(ret) + "----" + JSON.stringify(err));
					});
				}
			});
		}


		function openCarmerPai(){
			var selectPicListID_EL = document.getElementById("piclistTUI");
			var picNumber = $api.attr(selectPicListID_EL, 'value');
			if(picNumber >= 5){
				api.alert({
				    title: '错误提示',
				    msg: '每条商品最多只能拍五张图片',
				}, function(aaa, ccc) {
				});
				return;
			}

			api.addEventListener({
			    name: 'PaiPicFinish'
			}, function(ret, err) {
			    var PaiPicFinish = ret.value.PaiPicFinish;
			    if(PaiPicFinish == 'ok'){
			    	api.closeWin({
					    name: 'DIYCarmerWin'
					});
					api.closeWin({
					    name: 'showCarmerPicSale'
					});
			    	upload_toonline_diycarmer();
			    }
			});

			var recivetypebill = datalistitem.cSideType;
			var recivetypebilldetail = "";
			if(recivetypebill == '门店'){
				recivetypebilldetail = datalistitem.cReciverStore;
			}else{
				recivetypebilldetail = datalistitem.cSendStore;
			}

			openDiyCarmerPaiZhao(recivetypebilldetail, '签收拍照', '签收拍照');
		}

		function upload_toonline_diycarmer(){
			var myDate = new Date();
			var selectPicAdd = document.getElementById("selectPicAdd");
			var elimg = '<img onclick="showpic(this)" id="'+myDate.getTime()+'" name="'+DiyCarmerFinishChu_name+'" src="'+'data:image/jpg;base64,' + DiyCarmerFinishChu_url+'" />';
			$api.before(selectPicAdd, elimg);
			var selectPicListID_EL = document.getElementById("piclistTUI");
			var picNumber = $api.attr(selectPicListID_EL, 'value');
			picNumber = parseInt(picNumber) + 1;
			$api.attr(selectPicListID_EL, 'value', picNumber);
			if(picNumber >= 5){
				$api.css(selectPicAdd,'display: none;');
			}
		}

		function showpic(tag) {
			api.openFrame({
			    name: 'showpic',
			    url: 'widget://html/sale/showpic.html',
			    rect: {
			        x: 0,
			        y: 0,
			        w: 'auto',
			        h: 'auto'
			    },
			    bounces: false,
			    bgColor: 'rgba(0,0,0,0.3)',
			    pageParam: {
			        url: $api.attr(tag, 'src'),
			        id: $api.attr(tag, 'id'),
			        divid: ""
			    }
			});

			api.addEventListener({
			    name: 'delthis'
			}, function(ret, err) {
				var id = ret.value.key1;
				var showpicdividID = document.getElementById("piclistTUI");
				var picNumber = $api.attr(showpicdividID, 'value');
				picNumber = parseInt(picNumber) - 1;
				$api.attr(showpicdividID, 'value', picNumber);
				delxml(id);
				api.removeEventListener({
				    name: 'delthis'
				});
				var selectPicAdd = document.getElementById("selectPicAdd");
				$api.css(selectPicAdd,'display: block;');
			});
		}

	</script>
</html>
